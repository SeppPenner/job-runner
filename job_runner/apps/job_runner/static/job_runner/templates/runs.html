<ng-include src="'/static/job_runner/templates/run_modal.html'"></ng-include>

<section id="dashboard">
    <div class="row">

        <div class="tabbable">
            <ul class="nav nav-tabs">
                <li ng-class="{active: global_state.data.runTab == 'scheduled'}" ng-click="setTab('scheduled')">
                    <a href="#scheduled" data-toggle="tab" target="_self">Scheduled</a>
                </li>
                <li ng-class="{active: global_state.data.runTab == 'scheduled_enqueue_disabled'}" ng-click="setTab('scheduled_enqueue_disabled')">
                    <a href="#scheduled_enqueue_disabled" data-toggle="tab" target="_self">Scheduled (enqueue disabled)</a>
                </li>
                <li ng-class="{active: global_state.data.runTab == 'inqueue'}" ng-click="setTab('inqueue')">
                    <a href="#inqueue" data-toggle="tab" target="_self">In queue</a>
                </li>
                <li ng-class="{active: global_state.data.runTab == 'started'}" ng-click="setTab('started')">
                    <a href="#started" data-toggle="tab" target="_self">Started</a>
                </li>
                <li ng-class="{active: global_state.data.runTab == 'completed'}" ng-click="setTab('completed')">
                    <a href="#completed" data-toggle="tab" target="_self">Completed</a>
                </li>
                <li ng-class="{active: global_state.data.runTab == 'error'}" ng-click="setTab('error')">
                    <a href="#error" data-toggle="tab" target="_self">Completed with error</a>
                </li>
            </ul>
            <div class="tab-content">
                <div id="scheduled" ng-class="{active: global_state.data.runTab == 'scheduled', 'tab-pane': true}">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Job</th>
                                <th>Scheduled</th>
                                <th>Worker pool</th>
                                <th>Assigned worker</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="run in runs | filter:runFilter('scheduled') | filter:enqueueEnabledFilter(true) | orderBy:'schedule_dts'">
                                <td><a href="{{ run.id }}/">{{ run.get_job().title }}</a></td>
                                <td ng-class="{disabled: run.get_job().enqueue_is_enabled != true}">{{ run.schedule_dts | formatdts }}</td>
                                <td>{{ run.get_job().get_worker_pool().title }}</td>
                                <td>{{ run.get_worker().title }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="scheduled_enqueue_disabled" ng-class="{active: global_state.data.runTab == 'scheduled_enqueue_disabled', 'tab-pane': true}">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Job</th>
                                <th>Scheduled</th>
                                <th>Worker pool</th>
                                <th>Assigned worker</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="run in runs | filter:runFilter('scheduled') | filter:enqueueEnabledFilter(false) | orderBy:'schedule_dts'">
                                <td><a href="{{ run.id }}/">{{ run.get_job().title }}</a></td>
                                <td>{{ run.schedule_dts | formatdts }}</td>
                                <td>{{ run.get_job().get_worker_pool().title }}</td>
                                <td>{{ run.get_worker().title }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="inqueue" ng-class="{active: global_state.data.runTab == 'inqueue', 'tab-pane': true}">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Job</th>
                                <th>In queue</th>
                                <th>Worker pool</th>
                                <th>Assigned worker</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="run in runs | filter:runFilter('in_queue') | orderBy:'enqueue_dts'">
                                <td><a href="{{ run.id }}/">{{ run.get_job().title }}</a></td>
                                <td>{{ run.enqueue_dts | formatdts }}</td>
                                <td>{{ run.get_job().get_worker_pool().title }}</td>
                                <td>{{ run.get_worker().title }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="started" ng-class="{active: global_state.data.runTab == 'started', 'tab-pane': true}">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Job</th>
                                <th>Started</th>
                                <th>Worker pool</th>
                                <th>Assigned worker</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="run in runs | filter:runFilter('started') | orderBy:'-start_dts'">
                                <td><a href="{{ run.id }}/">{{ run.get_job().title }}</a></td>
                                <td>{{ run.start_dts | formatdts }}</td>
                                <td>{{ run.get_job().get_worker_pool().title }}</td>
                                <td>{{ run.get_worker().title }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="completed" ng-class="{active: global_state.data.runTab == 'completed', 'tab-pane': true}">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Job</th>
                                <th>Returned</th>
                                <th>Worker pool</th>
                                <th>Assigned worker</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="run in runs | filter:runFilter('completed') | orderBy:'-return_dts'">
                                <td><a href="{{ run.id }}/">{{ run.get_job().title }}</a></td>
                                <td>{{ run.return_dts | formatdts }}</td>
                                <td>{{ run.get_job().get_worker_pool().title }}</td>
                                <td>{{ run.get_worker().title }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="error" ng-class="{active: global_state.data.runTab == 'error', 'tab-pane': true}">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Job</th>
                                <th>Returned</th>
                                <th>Worker pool</th>
                                <th>Assigned worker</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="run in runs | filter:runFilter('completed_with_error') | orderBy:'-return_dts'">
                                <td><a href="{{ run.id }}/">{{ run.get_job().title }}</a></td>
                                <td>{{ run.return_dts | formatdts }}</td>
                                <td>{{ run.get_job().get_worker_pool().title }}</td>
                                <td>{{ run.get_worker().title }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</section>
