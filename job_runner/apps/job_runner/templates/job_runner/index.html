{% extends "base.html" %}

{% block extrahead %}
    <script type="text/javascript">
        var ws_server = '{{ ws_server }}';
    </script>

    <script type="text/html" id="run-template">
        <div style='display: none;' class='job-run job-<%= state %><% if(suspended) { %> suspended<% } %>' id='run-<%= id %>' data-id='<%= id %>' data-job_id='<%= job_id %>' data-timestamp='<%= timestamp %>'>
            <h5>
                <a href='<%= id %>/' class='details js-link'><%= title %></a>
            </h5>
            <ul>
                <li><i class='icon-hdd'></i> <%= server %></li>
                <li><i class='<% if(suspended) { %>icon-ban-circle<% } else { %>icon-time<% } %>'></i> <%= timestamp %></li>
            </ul>
        </div>
    </script>

    <script type="text/html" id="run-modal-template">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="run_modal_title">Run: <a href="../../jobs/<%= job_id %>/"><%= title %></a></h3>
        </div>
        <div class="modal-body" id="status-modal">
            <h3>Status</h3>
            <p class="state"><%= state %><% if(suspended) { %> (suspended)<% } %></p>
            <h3>Scheduled</h3>
            <p class="schedule_dts"><%= schedule_dts %></p>
            <% if(enqueue_dts) { %>
                <h3>In queue</h3>
                <p class="enqueue_dts"><%= enqueue_dts %></p>
            <% } %>
            <% if(start_dts) { %>
                <h3>Started</h3>
                <p class="start_dts"><%= start_dts %></p>
            <% } %>
            <% if (return_dts) { %>
                <h3>Returned</h3>
                <p class="return_dts"><%= return_dts %></p>
            <% } %>
            <% if(run_duration) { %>
                <h3>Run duration</h3>
                <p class="run_duration"><%= run_duration %></p>
            <% } %>
            <h3>Command</h3>
            <p><pre class="script_content"><%= script_content %></pre></p>
            <% if(return_log) { %>
                <h3>Log output</h3>
                <p><pre class="return_log"><%= return_log %></pre></p>
            <% } %>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
    </script>

    <script type="text/html" id="job-modal-template">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="run_modal_title">Job: <%= title %><% if(!enqueue_is_enabled) { %> (enqueue suspended)<% } %></h3>
        </div>
        <div class="modal-body" id="status-modal">
            <h3>Command</h3>
            <p><pre class="script_content"><%= script_content %></pre></p>
        </div>
        <div class="modal-footer">
            <div class="btn-group schedule-job-group">
                <button class="btn schedule-job" data-job_url="<%= job_url %>" data-job_id="<%= id %>" data-schedule_children="false"><i class="icon-play"></i> <span>Schedule now</span></button>
                <% if (children.length) { %>
                    <button class="btn dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a href="#" class="schedule-job" data-job_url="<%= job_url %>" data-job_id="<%= id %>" data-schedule_children="true">Schedule now incl. children</a></li>
                    </ul>
                <% } %>
            </div>

            <button class="btn toggle-enable-job" data-job_id="<%= id %>"><span></span></button>
            <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
        </div>
    </script>

    <script type="text/html" id="job-template">
        <div class="span2" id="job-<%= id %>" style="display: none;">
            <div class="job<% if(!enqueue_is_enabled) { %> suspended<% } %>" data-id="<%= id %>">
                <h5><a href="<%= id %>/" class="details js-link"><%= title %></a></h5>
                <ul>
                    <li>
                        <i class="icon-tag"></i> <%= hostname %>
                    </li>
                </ul>
            </div>
        </div>
    </script>
{% endblock %}

{% block navbar %}
<ul class="nav">
    <li class="active dashboard"><a href="../runs/">Dashboard</a></li>
    <li class="jobs"><a href="../jobs/">Jobs</a></li>
</ul>

<ul class="nav pull-right" id="project-list">
    <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span></span> <b class="caret"></b></a>
        <ul class="dropdown-menu">
        </ul>
    </li>
</ul>

{% endblock %}

{% block extracss %}
    <link rel="stylesheet/less" href="{{ STATIC_URL }}job_runner/less/job_runner.less" />
{% endblock %}

{% block bodyid %}job_runner{% endblock %}

{% block content %}
    <div class="modal hide fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="run_modal_title" aria-hidden="true">
    </div>

    <section class="hide" id="dashboard">
        <div class="row">
            <div class="span2">
                <h4>Scheduled</h4>
                <div id="scheduled-runs"></div>
            </div>
            <div class="span2">
                <h4>In queue</h4>
                <div id="enqueued-runs"></div>
            </div>
            <div class="span2">
                <h4>Started</h4>
                <div id="started-runs"></div>
            </div>
            <div class="span2">
                <h4>Completed</h4>
                <div id="completed-runs"></div>
            </div>
            <div class="span2">
                <h4>Completed (error)</h4>
                <div id="completed-with-error-runs"></div>
            </div>
        </div>
    </section>

    <section class="hide" id="jobs">
        <h1>Jobs</h1>
        <div class="row">
            <div class="span6 jobs"></div>
            <div class="span6 job-details">
                <div class="hero-unit">
                    <p>Click on a job to see its details and run history...</p>
                </div>
            </div>
        </div>
    </section>

{% endblock %}

{% block extrajs %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap/bootstrap-modal.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap/bootstrap-transition.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap/bootstrap-tab.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/json2.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.csrf.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/moment.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/underscore.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/backbone.min.js"></script>

    <script type="text/javascript" src="{{ STATIC_URL }}job_runner/js/models.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}job_runner/js/collections.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}job_runner/js/views/projects.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}job_runner/js/views/runs.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}job_runner/js/views/jobs.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}job_runner/js/router.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}job_runner/js/boot.js"></script>
{% endblock %}
